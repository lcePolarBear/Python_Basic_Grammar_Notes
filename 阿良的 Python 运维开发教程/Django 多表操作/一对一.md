# 多表操作：一对一
## 创建模型关系
- 向模型类添加模型
    ```python
    # models.py
    from django.db import models

    # 原有的用户表，作为父表
    class User(models.Model):
        user = models.CharField(max_length=30, verbose_name="用户名")
        name = models.CharField(max_length=30, verbose_name="姓名")
        sex = models.CharField(max_length=10, verbose_name="性别")
        age = models.IntegerField(verbose_name="年龄")
        label = models.CharField(max_length=100, verbose_name="标签")

        class Meta:
            db_table = "user"
            verbose_name = "用户表"
            verbose_name_plural = "用户表"
            ordering = ['id']

        def __str__(self):
            return self.name

    # 新创建一个身份证表，用于和用户表一对一对应，作为子表
    class IdCord(models.Model):
        number = models.CharField(max_length=18, verbose_name="身份证号")
        address = models.CharField(max_length=50, verbose_name="家庭地址", default="beijing")
        # 定义一对一的关系，并且必须添加 on_delete 删除关系
        user = models.OneToOneField(User, on_delete=models.CASCADE)

        class Meta:
            db_table = "id"
            verbose_name = "身份证表"
            verbose_name_plural = "身份证表"
            ordering = ["id"]

        def __str__(self):
            return self.number
    ```
- 向后台注册模型类
    ```python
    # myapp/admin.py
    from django.contrib import admin
    from myapp import models

    admin.site.register(models.User)
    admin.site.register(models.IdCord)
    ```
- 生成迁移文件并同步数据库
    ```bash
    python manage.py makemigrations
    python manage.py migrate
    ```
## 一对一增删改查
### 增
- 同步增
    ```python
    # views.py
    from django.http import HttpResponse
    from myapp.models import User,IdCord

    def data_create(request):
        user_obj = User.objects.create(
            user="112",
            name="kun",
            sex="man",
            age=24,
            label="devops"
        )
        IdCord.objects.create(
            user = user_obj,
            number="123456789",
        )
        return HttpResponse("新增成功！")
    ```
- 向已有用户添加身份证信息
    ```python
    # views.py
    from django.http import HttpResponse
    from myapp.models import User,IdCord

    def data_create(request):
        user_obj = User.objects.get(user="chen")
        id_obj = IdCord.objects.create(
            user = user_obj,
            number="123456789",
        )
        return HttpResponse("新增成功！")
    ```
### 删
- 由于两表之间存在 on_detele 关联，删除 User 数据时 IdCard 会同步删除对应数据
    ```python
    # views.py
    from django.http import HttpResponse
    from myapp.models import User,IdCord

    def data_delete(request):
        User.objects.filter(user="chen").delete()
        return HttpResponse("删除成功！")
    ```
### 改
- 通过 User 用户的对象修改 IdCard 信息
```python
    # views.py
    from django.http import HttpResponse
    from myapp.models import User,IdCord

    def data_update(request):
        user_obj = User.objects.get(user="chen")
        # 修改 IdCard 信息
        user_obj.idcord.address = "shanghai"
        # 修改 User 表信息
        user_obj.age = 25
        # 保存 IdCard 信息
        user_obj.idcord.save()
        # 保存 User 表信息
        user_obj.save()
        return HttpResponse("修改完成！")
```
### 查
- 正向查询：从 IdCard 查 User
    ```python
    # views.py
    from django.http import HttpResponse
    from myapp.models import User,IdCord

    def data_select(request):
        user_obj = User.objects.get(user="chen")
        return HttpResponse(user_obj.idcord.number)
    ```
- 反向查询：从 User 查 IdCard
    ```python
    # views.py
    from django.http import HttpResponse
    from myapp.models import User,IdCord

    def data_select(request):
        id_obj = IdCord.objects.get(user="2")
        return HttpResponse(id_obj.user.user)